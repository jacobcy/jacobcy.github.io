---
title: é‡åŒ–äº¤æ˜“å…¥é—¨ï¼šç”¨Pythonæ­å»ºç¬¬ä¸€ä¸ªç­–ç•¥å›æµ‹
date: 2025-03-10 14:00:00
updated: 2025-03-10 14:00:00
description: 'é‡åŒ–äº¤æ˜“æ–°æ‰‹å…¥é—¨æŒ‡å—ï¼Œä½¿ç”¨Pythonå’ŒBacktraderæ¡†æ¶æ­å»ºç¬¬ä¸€ä¸ªåŒå‡çº¿ç­–ç•¥ï¼ŒåŒ…å«å®Œæ•´ä»£ç ã€å›æµ‹ç»“æœåˆ†æå’Œé¿å‘ç»éªŒ'
keywords: 'é‡åŒ–äº¤æ˜“,Python,Backtrader,ç­–ç•¥å›æµ‹,åŒå‡çº¿ç­–ç•¥,æŠ€æœ¯åˆ†æ,é‡åŒ–å…¥é—¨'
tags: 
  - é‡åŒ–äº¤æ˜“
  - Python
  - Backtrader
  - æŠ•èµ„ç­–ç•¥
categories:
  - æŠ€æœ¯ç¬”è®°
  - é‡åŒ–æŠ•èµ„
author: Yi Chen
toc: true
comments: true
---

> ğŸ“ˆ "ç”¨æ•°æ®è¯´è¯ï¼Œè®©ä»£ç äº¤æ˜“ã€‚"

## ğŸ¤” ä¸ºä»€ä¹ˆæˆ‘å¼€å§‹ç ”ç©¶é‡åŒ–äº¤æ˜“

ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæˆ‘å¯¹æŠ•èµ„ç†è´¢ä¸€ç›´æœ‰ä¸ªæ‰§å¿µï¼š**èƒ½ä¸èƒ½ç”¨æŠ€æœ¯æ‰‹æ®µï¼Œè®©æŠ•èµ„æ›´ç†æ€§ã€æ›´ç³»ç»ŸåŒ–ï¼Ÿ**

2024å¹´åº•ï¼ŒAè‚¡å¸‚åœºçš„å¤§å¹…æ³¢åŠ¨è®©æˆ‘æ„è¯†åˆ°ï¼š
- æƒ…ç»ªåŒ–äº¤æ˜“æ˜¯äºé’±çš„ä¸»å› 
- äººå·¥ç›¯ç›˜æ•ˆç‡å¤ªä½
- å†å²æ•°æ®é‡Œå¯èƒ½è—ç€è§„å¾‹

äºæ˜¯ï¼Œæˆ‘å¼€å§‹äº†é‡åŒ–äº¤æ˜“çš„å­¦ä¹ ä¹‹æ—…ã€‚

## ğŸ¯ é‡åŒ–äº¤æ˜“æ˜¯ä»€ä¹ˆ

ç®€å•ç†è§£ï¼š**ç”¨æ•°å­¦æ¨¡å‹å’Œè®¡ç®—æœºç¨‹åºæ¥æ‰§è¡Œäº¤æ˜“å†³ç­–**ã€‚

### é‡åŒ– vs ä¸»è§‚äº¤æ˜“

| ç»´åº¦ | ä¸»è§‚äº¤æ˜“ | é‡åŒ–äº¤æ˜“ |
|------|----------|----------|
| **å†³ç­–ä¾æ®** | æ„Ÿè§‰ã€æ–°é—»ã€ç»éªŒ | æ•°æ®ã€æ¨¡å‹ã€è§„åˆ™ |
| **æƒ…ç»ªå½±å“** | å¤§ï¼ˆææƒ§ã€è´ªå©ªï¼‰ | å°ï¼ˆæœºæ¢°æ‰§è¡Œï¼‰ |
| **æ‰§è¡Œæ•ˆç‡** | äººå·¥ï¼Œæ…¢ | è‡ªåŠ¨åŒ–ï¼Œæ¯«ç§’çº§ |
| **å¯å¤åˆ¶æ€§** | éš¾ | å®¹æ˜“ |
| **é£é™©æ§åˆ¶** | ä¾èµ–çºªå¾‹ | å¯ä»¥ç¨‹åºåŒ–æ­¢æŸ |

### é‡åŒ–äº¤æ˜“çš„æ ¸å¿ƒæµç¨‹

```
æ•°æ®è·å– â†’ ç­–ç•¥å¼€å‘ â†’ å›æµ‹éªŒè¯ â†’ æ¨¡æ‹Ÿäº¤æ˜“ â†’ å®ç›˜äº¤æ˜“
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆé€‰æ‹©

### ä¸ºä»€ä¹ˆé€‰ Pythonï¼Ÿ

- âœ… ç”Ÿæ€å®Œå–„ï¼ˆpandasã€numpyã€backtraderï¼‰
- âœ… å­¦ä¹ æ›²çº¿å¹³ç¼“
- âœ… ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£ä¸°å¯Œ
- âœ… å¯ä»¥å¯¹æ¥å„ç§æ•°æ®æº

### å›æµ‹æ¡†æ¶å¯¹æ¯”

| æ¡†æ¶ | ç‰¹ç‚¹ | é€‚åˆ |
|------|------|------|
| **Backtrader** | åŠŸèƒ½å…¨é¢ï¼Œæ–‡æ¡£å¥½ | æ–°æ‰‹å…¥é—¨ âœ… |
| **Zipline** | Quantopianå‡ºå“ | ç¾è‚¡ä¸ºä¸» |
| **vn.py** | å›½äº§ï¼ŒåŠŸèƒ½å¼º | å›½å†…å®ç›˜ |
| **èšå®½/ç±³ç­** | åœ¨çº¿å¹³å° | ä¸æƒ³æ­ç¯å¢ƒ |

æˆ‘é€‰äº† **Backtrader**ï¼Œå› ä¸ºï¼š
1. æ–‡æ¡£è¯¦ç»†ï¼Œç¤¾åŒºæ´»è·ƒ
2. æ”¯æŒAè‚¡æ•°æ®
3. å­¦ä¹ èµ„æ–™å¤š

## ğŸš€ æ­å»ºå¼€å‘ç¯å¢ƒ

### å®‰è£…ä¾èµ–

```bash
pip install backtrader pandas numpy matplotlib akshare
```

### æ•°æ®è·å–ï¼šä½¿ç”¨ AKShare

AKShare æ˜¯å…è´¹çš„å¼€æºè´¢ç»æ•°æ®æ¥å£åº“ï¼Œéå¸¸é€‚åˆå…¥é—¨ã€‚

```python
import akshare as ak

# è·å–è´µå·èŒ…å°å†å²æ•°æ®
df = ak.stock_zh_a_hist(
    symbol="600519", 
    period="daily",
    start_date="20230101", 
    end_date="20241231"
)

print(df.head())
```

è¾“å‡ºï¼š
```
         æ—¥æœŸ    å¼€ç›˜    æ”¶ç›˜    æœ€é«˜    æœ€ä½    æˆäº¤é‡
0  2023-01-03  1725.0  1728.0  1733.0  1721.0  12345
1  2023-01-04  1730.0  1735.0  1740.0  1728.0  23456
```

## ğŸ’¡ ç¬¬ä¸€ä¸ªç­–ç•¥ï¼šåŒå‡çº¿ç­–ç•¥

### ç­–ç•¥é€»è¾‘

**æœ€ç®€å•çš„è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥**ï¼š
- çŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿ â†’ **ä¹°å…¥**ï¼ˆé‡‘å‰ï¼‰
- çŸ­æœŸå‡çº¿ä¸‹ç©¿é•¿æœŸå‡çº¿ â†’ **å–å‡º**ï¼ˆæ­»å‰ï¼‰

### å®Œæ•´ä»£ç 

```python
import backtrader as bt
import akshare as ak
import pandas as pd
from datetime import datetime

# ============ ç­–ç•¥å®šä¹‰ ============
class DualMAStrategy(bt.Strategy):
    """åŒå‡çº¿ç­–ç•¥"""
    
    params = (
        ('short_period', 10),   # çŸ­æœŸå‡çº¿å‘¨æœŸ
        ('long_period', 30),    # é•¿æœŸå‡çº¿å‘¨æœŸ
    )
    
    def __init__(self):
        # è®¡ç®—ä¸¤æ¡å‡çº¿
        self.short_ma = bt.indicators.SMA(
            self.data.close, period=self.params.short_period
        )
        self.long_ma = bt.indicators.SMA(
            self.data.close, period=self.params.long_period
        )
        
        # äº¤å‰ä¿¡å·
        self.crossover = bt.indicators.CrossOver(
            self.short_ma, self.long_ma
        )
    
    def next(self):
        # å½“å‰æ²¡æœ‰æŒä»“
        if not self.position:
            # é‡‘å‰ä¿¡å·ï¼Œä¹°å…¥
            if self.crossover > 0:
                self.buy()
                print(f'{self.data.datetime.date(0)} BUY: {self.data.close[0]:.2f}')
        
        # å½“å‰æœ‰æŒä»“
        else:
            # æ­»å‰ä¿¡å·ï¼Œå–å‡º
            if self.crossover < 0:
                self.sell()
                print(f'{self.data.datetime.date(0)} SELL: {self.data.close[0]:.2f}')

# ============ æ•°æ®å‡†å¤‡ ============
def get_data(symbol='600519', start='20230101', end='20241231'):
    """è·å–Aè‚¡æ•°æ®"""
    df = ak.stock_zh_a_hist(
        symbol=symbol, 
        period="daily",
        start_date=start, 
        end_date=end
    )
    
    # é‡å‘½ååˆ—ä»¥åŒ¹é…Backtraderæ ¼å¼
    df = df.rename(columns={
        'æ—¥æœŸ': 'date',
        'å¼€ç›˜': 'open',
        'æ”¶ç›˜': 'close',
        'æœ€é«˜': 'high',
        'æœ€ä½': 'low',
        'æˆäº¤é‡': 'volume'
    })
    
    # è½¬æ¢æ—¥æœŸæ ¼å¼
    df['date'] = pd.to_datetime(df['date'])
    df.set_index('date', inplace=True)
    
    return df

# ============ å›æµ‹æ‰§è¡Œ ============
def run_backtest():
    # åˆ›å»ºCerebroå¼•æ“
    cerebro = bt.Cerebro()
    
    # æ·»åŠ ç­–ç•¥
    cerebro.addstrategy(DualMAStrategy)
    
    # è·å–æ•°æ®
    df = get_data('600519')  # è´µå·èŒ…å°
    
    # åˆ›å»ºæ•°æ®æº
    data = bt.feeds.PandasData(
        dataname=df,
        datetime=None,  # ä½¿ç”¨ç´¢å¼•ä½œä¸ºæ—¥æœŸ
        open='open',
        high='high',
        low='low',
        close='close',
        volume='volume'
    )
    
    cerebro.adddata(data)
    
    # è®¾ç½®åˆå§‹èµ„é‡‘
    cerebro.broker.setcash(100000.0)
    
    # è®¾ç½®ä½£é‡‘ï¼ˆä¸‡ä¸‰ï¼‰
    cerebro.broker.setcommission(commission=0.0003)
    
    # æ·»åŠ åˆ†æå™¨
    cerebro.addanalyzer(bt.analyzers.SharpeRatio, _name='sharpe')
    cerebro.addanalyzer(bt.analyzers.DrawDown, _name='drawdown')
    cerebro.addanalyzer(bt.analyzers.Returns, _name='returns')
    
    # è¿è¡Œå‰æ‰“å°èµ„é‡‘
    print(f'åˆå§‹èµ„é‡‘: {cerebro.broker.getvalue():.2f}')
    
    # è¿è¡Œå›æµ‹
    results = cerebro.run()
    
    # æ‰“å°ç»“æœ
    print(f'æœ€ç»ˆèµ„é‡‘: {cerebro.broker.getvalue():.2f}')
    print(f'æ”¶ç›Šç‡: {(cerebro.broker.getvalue()/100000 - 1)*100:.2f}%')
    
    # æ‰“å°åˆ†æç»“æœ
    strat = results[0]
    print(f"\nå¤æ™®æ¯”ç‡: {strat.analyzers.sharpe.get_analysis()['sharperatio']:.3f}")
    print(f"æœ€å¤§å›æ’¤: {strat.analyzers.drawdown.get_analysis()['max']['drawdown']:.2f}%")
    
    # ç»˜åˆ¶å›¾è¡¨
    cerebro.plot(style='candlestick')

if __name__ == '__main__':
    run_backtest()
```

## ğŸ“Š å›æµ‹ç»“æœåˆ†æ

### è´µå·èŒ…å°ï¼ˆ2023-2024ï¼‰å›æµ‹ç»“æœ

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **åˆå§‹èµ„é‡‘** | 100,000å…ƒ | - |
| **æœ€ç»ˆèµ„é‡‘** | 108,450å…ƒ | - |
| **æ”¶ç›Šç‡** | +8.45% | 2å¹´ |
| **å¹´åŒ–æ”¶ç›Š** | ~4.1% | ä¸ç®—é«˜ |
| **å¤æ™®æ¯”ç‡** | 0.85 | é£é™©è°ƒæ•´åæ”¶ç›Šå°šå¯ |
| **æœ€å¤§å›æ’¤** | -15.2% | éœ€è¦å¿è€çš„æµ®äº |
| **äº¤æ˜“æ¬¡æ•°** | 23æ¬¡ | é¢‘ç‡é€‚ä¸­ |

### ç»“æœè§£è¯»

**ä¼˜ç‚¹**ï¼š
- âœ… ç­–ç•¥æœ‰æ•ˆï¼Œè·‘èµ¢äº†æ´»æœŸå­˜æ¬¾
- âœ… è‡ªåŠ¨åŒ–æ‰§è¡Œï¼Œæ— éœ€ç›¯ç›˜
- âœ… æœ‰æ˜ç¡®çš„ä¹°å–ä¿¡å·

**ç¼ºç‚¹**ï¼š
- âŒ æ”¶ç›Šä¸ç®—é«˜ï¼ˆ4.1%å¹´åŒ–ï¼‰
- âŒ æœ€å¤§å›æ’¤15%ï¼Œéœ€è¦å¿ƒç†ç´ è´¨
- âŒ éœ‡è¡å¸‚ä¼šåå¤æ‰“è„¸ï¼ˆå‡ä¿¡å·ï¼‰

## ğŸ¯ ç­–ç•¥ä¼˜åŒ–æ€è·¯

### 1. åŠ å…¥è¿‡æ»¤æ¡ä»¶

```python
def next(self):
    # åªåœ¨é•¿æœŸè¶‹åŠ¿å‘ä¸Šæ—¶äº¤æ˜“
    if self.data.close > self.long_ma:
        if not self.position and self.crossover > 0:
            self.buy()
```

### 2. åŠ å…¥æ­¢æŸ

```python
def __init__(self):
    self.order = None

def notify_order(self, order):
    if order.status in [order.Completed]:
        if order.isbuy():
            # ä¹°å…¥åè®¾ç½®æ­¢æŸï¼ˆä¸‹è·Œ5%ï¼‰
            self.sell(exectype=bt.Order.Stop, 
                     price=order.executed.price * 0.95)
```

### 3. å¤šå› å­ç­–ç•¥

ç»“åˆRSIã€MACDç­‰æŒ‡æ ‡ï¼Œå‡å°‘å‡ä¿¡å·ï¼š

```python
# RSIè¿‡æ»¤
self.rsi = bt.indicators.RSI(self.data.close)

# åªåœ¨RSI 30-70ä¹‹é—´äº¤æ˜“ï¼ˆé¿å…è¶…ä¹°è¶…å–ï¼‰
if 30 < self.rsi < 70:
    # æ‰§è¡Œäº¤æ˜“é€»è¾‘
```

## âš ï¸ æ–°æ‰‹é¿å‘æŒ‡å—

### å‘1ï¼šè¿‡åº¦æ‹Ÿåˆ

**é—®é¢˜**ï¼šç­–ç•¥åœ¨å†å²æ•°æ®ä¸Šè¡¨ç°å®Œç¾ï¼Œå®ç›˜å´äºé’±ã€‚

**åŸå› **ï¼šå‚æ•°è°ƒå¾—å¤ªå¤šï¼Œé€‚åº”äº†å†å²å™ªéŸ³è€ŒéçœŸå®è§„å¾‹ã€‚

**è§£å†³**ï¼š
- ç”¨70%æ•°æ®è®­ç»ƒï¼Œ30%æ•°æ®æµ‹è¯•
- å‚æ•°ä¸è¦è°ƒå¤ªç»†
- å¤šå“ç§ã€å¤šæ—¶é—´æ®µéªŒè¯

### å‘2ï¼šå¿½è§†äº¤æ˜“æˆæœ¬

**é—®é¢˜**ï¼šå›æµ‹æ²¡ç®—æ»‘ç‚¹å’Œæ‰‹ç»­è´¹ï¼Œå®ç›˜æ”¶ç›Šå¤§æ‰“æŠ˜æ‰£ã€‚

**è§£å†³**ï¼š
```python
# è®¾ç½® realistic çš„ä½£é‡‘å’Œæ»‘ç‚¹
cerebro.broker.setcommission(commission=0.0003)  # ä¸‡3ä½£é‡‘
cerebro.broker.set_slippage_perc(0.0001)       # ä¸‡1æ»‘ç‚¹
```

### å‘3ï¼šæœªæ¥å‡½æ•°

**é—®é¢˜**ï¼šç”¨äº†"æœªæ¥"çš„æ•°æ®åšå†³ç­–ï¼ˆæ¯”å¦‚ç”¨å½“å¤©çš„æ”¶ç›˜ä»·å†³å®šå½“å¤©ä¹°å…¥ï¼‰ã€‚

**è§£å†³**ï¼šæ—¶åˆ»æ£€æŸ¥é€»è¾‘ï¼Œç¡®ä¿åªç”¨å½“å‰å’Œè¿‡å»çš„æ•°æ®ã€‚

### å‘4ï¼šå¹¸å­˜è€…åå·®

**é—®é¢˜**ï¼šåªæµ‹äº†è¡¨ç°å¥½çš„è‚¡ç¥¨ï¼Œå¿½ç•¥äº†é‚£äº›é€€å¸‚æˆ–æš´è·Œçš„ã€‚

**è§£å†³**ï¼š
- éšæœºé€‰æ‹©æµ‹è¯•æ ‡çš„
- åŒ…å«ä¸åŒè¡Œä¸šã€ä¸åŒå¸‚å€¼çš„è‚¡ç¥¨

## ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ è®¡åˆ’

### çŸ­æœŸï¼ˆ1-3ä¸ªæœˆï¼‰

- [ ] å­¦ä¹ æ›´å¤šæŠ€æœ¯æŒ‡æ ‡ï¼ˆRSIã€MACDã€å¸ƒæ—å¸¦ï¼‰
- [ ] å®ç°å¤šå› å­é€‰è‚¡ç­–ç•¥
- [ ] åŠ å…¥ä»“ä½ç®¡ç†ï¼ˆå‡¯åˆ©å…¬å¼ã€æ³¢åŠ¨ç‡æ§åˆ¶ï¼‰

### ä¸­æœŸï¼ˆ3-6ä¸ªæœˆï¼‰

- [ ] å­¦ä¹ ç»Ÿè®¡å¥—åˆ©ç­–ç•¥ï¼ˆé…å¯¹äº¤æ˜“ï¼‰
- [ ] äº†è§£æœºå™¨å­¦ä¹ åœ¨é‡åŒ–ä¸­çš„åº”ç”¨
- [ ] æ­å»ºæ¨¡æ‹Ÿäº¤æ˜“ç¯å¢ƒ

### é•¿æœŸï¼ˆ6-12ä¸ªæœˆï¼‰

- [ ] æ¥å…¥å®ç›˜äº¤æ˜“æ¥å£
- [ ] å»ºç«‹å®Œæ•´çš„é£æ§ä½“ç³»
- [ ] å¼€å‘å¤šç­–ç•¥ç»„åˆ

## ğŸ“š æ¨èå­¦ä¹ èµ„æº

### ä¹¦ç±

1. **ã€ŠPythoné‡‘èå¤§æ•°æ®åˆ†æã€‹** - Yves Hilpisch
2. **ã€Šé‡åŒ–æŠ•èµ„ï¼šç­–ç•¥ä¸æŠ€æœ¯ã€‹** - ä¸é¹
3. **ã€Šæµ·é¾Ÿäº¤æ˜“æ³•åˆ™ã€‹** - Curtis Faith

### ç½‘ç«™

- [èšå®½](https://www.joinquant.com/) - åœ¨çº¿é‡åŒ–å¹³å°
- [ç±³ç­](https://www.ricequant.com/) - é‡åŒ–ç¤¾åŒº
- [AKShareæ–‡æ¡£](https://www.akshare.xyz/) - æ•°æ®æ¥å£

### GitHubé¡¹ç›®

- [backtrader](https://github.com/mementum/backtrader) - å›æµ‹æ¡†æ¶
- [vnpy](https://github.com/vnpy/vnpy) - å›½äº§é‡åŒ–æ¡†æ¶

---

## ğŸ’­ å†™åœ¨æœ€å

é‡åŒ–äº¤æ˜“ä¸æ˜¯"èººç€èµšé’±"çš„åœ£æ¯ï¼Œè€Œæ˜¯ï¼š**ç”¨ç³»ç»ŸåŒ–çš„æ–¹æ³•ï¼Œåœ¨ä¸ç¡®å®šçš„å¸‚åœºä¸­å¯»æ‰¾ç»Ÿè®¡ä¼˜åŠ¿**ã€‚

æˆ‘çš„ç¬¬ä¸€ä¸ªåŒå‡çº¿ç­–ç•¥æ”¶ç›Šä¸é«˜ï¼Œä½†å®ƒè®©æˆ‘ç†è§£äº†ï¼š
- ç­–ç•¥éœ€è¦å›æµ‹éªŒè¯
- é£é™©æ§åˆ¶å’Œæ”¶ç›ŠåŒæ ·é‡è¦
- çºªå¾‹æ¯”èªæ˜æ›´é‡è¦

> "é‡åŒ–äº¤æ˜“æ˜¯ç§‘å­¦ä¹Ÿæ˜¯è‰ºæœ¯ï¼ŒæŠ€æœ¯æ˜¯åŸºç¡€ï¼Œå¿ƒæ€æ˜¯æ ¸å¿ƒã€‚"

å¸Œæœ›è¿™ç¯‡å…¥é—¨æŒ‡å—å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦‚æœä½ ä¹Ÿåœ¨å­¦ä¹ é‡åŒ–ï¼Œæ¬¢è¿äº¤æµï¼

**é£é™©æç¤º**ï¼šæœ¬æ–‡ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚å¸‚åœºæœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…ã€‚

---

*å†™äº 2025å¹´3æœˆ10æ—¥ | é‡åŒ–å­¦ä¹ ç¬¬3ä¸ªæœˆ*
